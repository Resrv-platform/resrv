<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8" />
  <title>Clientomgeving</title>
  <style>
    html, body {
      margin: 0; padding: 0; height: 100%; overflow: hidden;
    }
    iframe {
      border: none; width: 100%; height: 100%;
    }
  </style>
</head>
<body>
  <iframe id="appFrame" allow="fullscreen"></iframe>

  <script>
    const iframe = document.getElementById('appFrame');

    function getFullPath() {
      return window.location.pathname + window.location.search + window.location.hash;
    }

    function updateIframeSrc() {
  const base = "https://rms.resrv.nl/clientindex";
  const fullPath = window.location.pathname + window.location.search + window.location.hash;
  const clientParam = "client=" + encodeURIComponent(window.location.hostname);

  // Voeg toe aan bestaande query of begin er een
  let connector = fullPath.includes("?") ? "&" : "?";
  iframe.src = base + fullPath + connector + clientParam;
}

    // 1. Laad juiste pagina bij openen
    updateIframeSrc();

    // 2. Browser-back / forward
    window.addEventListener("popstate", updateIframeSrc);

    // 3. Ontvang navigatieverzoeken vanuit iframe
    window.addEventListener("message", (event) => {
      if (event.origin !== "https://rms.resrv.nl") return;

      if (event.data?.type === "bubble:navigate") {
        const newPath = event.data.path;
        const currentPath = getFullPath();

        if (newPath !== currentPath) {
          history.pushState({}, '', newPath);
        }
      }
    });

    window.addEventListener("message", (event) => {
  // (Bestaande bubble:navigate check blijft zoals die is)

  if (event.data?.type === "bubble:request-origin") {
    iframe.contentWindow.postMessage({
      type: "client:domain",
      domain: window.location.hostname
    }, "*");
  }
});
  </script>
</body>
</html>
